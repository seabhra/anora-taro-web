<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#6b46c1">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

    <title>Anora Tar√¥</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f7f7f7;
            text-align: center;
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .card { width: 90px; }

        .card img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .label { margin-top: 6px; font-size: 13px; font-weight: bold; }

        .card-name { font-size: 11px; color: #6b46c1; min-height: 14px; }

        .action-button {
            width: 100%;
            max-width: 320px;
            height: 50px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .action-button:active { transform: scale(0.98); }
        .pink { background:#fd98be; }
        .blue { background:#98e6ce; }

        #status {
            margin-top: 16px;
            font-weight: bold;
            color: #718096;
        }

        #status.status-loading { color: #6b46c1; }
        #status.status-success { color: #38a169; }
        #status.status-error { color: #e53e3e; }

        /* Loader de consulta √† API */
        #loader {
            display: none;
            margin: 20px auto;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(131, 242, 212, 0.2);
            border-top: 5px solid #83f2d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Loader Inicial da P√°gina */
        #pageLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .hidden { display: none !important; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .page-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(131, 242, 212, 0.3);
            border-top: 6px solid #83f2d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #aiResponse {
            display: none;
            margin-top: 16px;
            padding: 14px;
            background: #fff;
            border-radius: 12px;
            font-size: 14px;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #aiResponse h2 { text-align: center; color: #6b46c1; font-size: 18px; margin-top: 0; }
        #aiResponse p { line-height: 1.6; color: #2d3748; }

        #shareButton {
            display: none;
            width: 60px;
            height: 60px;
            margin: 16px auto 0;
            border-radius: 50%;
            background-color: #25D366;
            justify-content: center;
            align-items: center;
            text-decoration: none;
        }

        #shareButton img { width: 35px; height: 35px; }

        #promptBox {
            display: none;
            margin-top: 12px;
            padding: 10px;
            background: #f0f0f5;
            border-radius: 10px;
            font-size: 13px;
            text-align: left;
        }
    </style>
</head>
<body>

<div id="pageLoader">
    <div class="page-spinner"></div>
</div>

<div class="cards">
    <div class="card">
        <img id="card1" src="cards_images/back.jpg" alt="Carta 1">
        <div class="label">Passado</div>
        <div class="card-name" id="name1"></div>
    </div>
    <div class="card">
        <img id="card2" src="cards_images/back.jpg" alt="Carta 2">
        <div class="label">Presente</div>
        <div class="card-name" id="name2"></div>
    </div>
    <div class="card">
        <img id="card3" src="cards_images/back.jpg" alt="Carta 3">
        <div class="label">Futuro</div>
        <div class="card-name" id="name3"></div>
    </div>
</div>

<button id="actionButton" class="action-button pink">‚ú® Consultar Cartas</button>

<div id="status">Aguardando sua consulta</div>
<div id="loader"></div>
<div id="promptBox"></div>
<div id="aiResponse"></div>

<a id="shareButton" href="#">
    <img src="cards_images/zap.png" alt="WhatsApp">
</a>

<script>
    // Fun√ß√£o para remover o loader inicial
    function hidePageLoader() {
        const pl = document.getElementById('pageLoader');
        if (pl) pl.classList.add('hidden');
    }

    // Garante que o loader saia mesmo se houver erro no script
    window.onload = hidePageLoader;

    document.addEventListener('DOMContentLoaded', () => {
        const basePath = 'cards_images/';
        const backCard = basePath + 'back.jpg';

        const cards = [
            { label:'Louco', file:'01_Louco' }, { label:'Mago', file:'02_Mago' },
            { label:'Sacerdotisa', file:'03_Sacerdotisa' }, { label:'Imperatriz', file:'04_Imperatriz' },
            { label:'Imperador', file:'05_Imperador' }, { label:'Sacerdote', file:'06_Sacerdote' },
            { label:'Amantes', file:'07_Amantes' }, { label:'Carro', file:'08_Carro' },
            { label:'For√ßa', file:'09_Forca' }, { label:'Eremita', file:'10_Eremita' },
            { label:'Roda da Fortuna', file:'11_Roda' }, { label:'Justi√ßa', file:'12_Justica' },
            { label:'Enforcado', file:'13_Enforcado' }, { label:'Morte', file:'14_Morte' },
            { label:'Temperan√ßa', file:'15_Temperanca' }, { label:'Diabo', file:'16_Diabo' },
            { label:'Torre', file:'17_Torre' }, { label:'Estrela', file:'18_Estrela' },
            { label:'Lua', file:'19_Lua' }, { label:'Sol', file:'20_Sol' },
            { label:'Julgamento', file:'21_Julgamento' }, { label:'Mundo', file:'22_Mundo' }
        ];

        const imgs = [document.getElementById('card1'), document.getElementById('card2'), document.getElementById('card3')];
        const labels = [document.getElementById('name1'), document.getElementById('name2'), document.getElementById('name3')];
        const button = document.getElementById('actionButton');
        const status = document.getElementById('status');
        const loader = document.getElementById('loader');
        const aiBox = document.getElementById('aiResponse');
        const promptBox = document.getElementById('promptBox');
        const shareButton = document.getElementById('shareButton');

        let hasReading = false;

        function shuffle(arr) {
            return [...arr].sort(() => Math.random() - 0.5);
        }

        function newReading() {
            const shuffled = shuffle(cards).slice(0, 3);
            shuffled.forEach((card, i) => {
                imgs[i].src = `${basePath}${card.file}.jpg`;
                labels[i].innerText = card.label;
            });

            const drawnNames = shuffled.map(c => c.label);
            
            // CORRE√á√ÉO: Aspas fechadas corretamente aqui
            aiBox.style.display = 'none'; 
            promptBox.style.display = 'block';
            promptBox.innerHTML = `<strong>üìú Cartas Selecionadas:</strong><br>Passado: ${drawnNames[0]} | Presente: ${drawnNames[1]} | Futuro: ${drawnNames[2]}`;
            
            loader.style.display = 'block';
            shareButton.style.display = 'none';
            
            status.textContent = 'Consultando a IA...';
            status.className = 'status-loading';
            
            callAuroraAPI(drawnNames);
            hasReading = true;
            button.innerText = 'üîÑ Nova Consulta';
            button.className = 'action-button blue';
        }

        function resetReading() {
            imgs.forEach(img => img.src = backCard);
            labels.forEach(l => l.innerText = '');
            promptBox.style.display = 'none';
            aiBox.style.display = 'none';
            shareButton.style.display = 'none';
            loader.style.display = 'none';
            button.innerText = '‚ú® Consultar Cartas';
            button.className = 'action-button pink';
            status.textContent = 'Aguardando sua consulta';
            status.className = '';
            hasReading = false;
        }

        async function callAuroraAPI(cardsDrawn) {
            try {
                const res = await fetch('https://aurora-api-final-2025.vercel.app/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'llama-3.3-70b-versatile',
                        messages: [{ 
                            role: "user", 
                            content: `Analise: Passado ${cardsDrawn[0]}, Presente ${cardsDrawn[1]}, Futuro ${cardsDrawn[2]}. Use 4 par√°grafos com t√≠tulos em negrito.` 
                        }],
                        temperature: 0.7
                    })
                });

                if (!res.ok) throw new Error('Erro na resposta da API');
                const data = await res.json();
                const text = data.choices?.[0]?.message?.content || 'Sem an√°lise dispon√≠vel.';
                
                aiBox.innerHTML = `<h2>üîÆ Anora Assistente de IA</h2><p>${text.replace(/\n/g, '<br>')}</p>`;
                status.textContent = '‚úÖ Consulta realizada';
                status.className = 'status-success';
                aiBox.style.display = 'block';
                shareButton.style.display = 'flex';
            } catch (error) {
                aiBox.innerHTML = `<h2>‚ö†Ô∏è Erro</h2><p>${error.message}</p>`;
                aiBox.style.display = 'block';
                status.textContent = '‚ùå Erro ao consultar';
                status.className = 'status-error';
            } finally {
                loader.style.display = 'none';
            }
        }

        button.onclick = () => hasReading ? resetReading() : newReading();
        
        shareButton.onclick = (e) => {
            e.preventDefault();
            const text = encodeURIComponent(aiBox.innerText);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        };

        hidePageLoader();
    });
</script>
</body>
</html>
