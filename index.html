<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#6b46c1">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<title>Anora Tarô</title>

<style>
body {
margin: 0;
padding: 20px;
font-family: Arial, Helvetica, sans-serif;
background: #f7f7f7;
text-align: center;
}

.cards {
display: flex;
justify-content: center;
gap: 12px;
margin-bottom: 24px;
}

.card { width: 90px; }

.card img {
width: 100%;
border-radius: 10px;
box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.label {
margin-top: 6px;
font-size: 13px;
font-weight: bold;
}

.card-name {
font-size: 11px;
color: #6b46c1;
min-height: 14px;
}

.action-button {
width: 100%;
max-width: 320px;
height: 50px;
border: none;
border-radius: 4px;
font-size: 18px;
font-weight: bold;
color: #fff;
cursor: pointer;
}

.pink { background:#fd98be; }
.blue { background:#98e6ce; }

/* Estilo padrão do status */
#status {
margin-top: 16px;
font-weight: bold;
color: #718096;
transition: color 0.3s ease;
}

/* Classes para as cores do status */
#status.status-loading {
color: #6b46c1; /* Roxo */
}

#status.status-success {
color: #38a169; /* Verde */
}

#status.status-error {
color: #3182ce; /* Azul */
}

/* Loader da API */
#loader {
display: none;
margin: 20px auto;
width: 50px;
height: 50px;
border: 5px solid rgba(131, 242, 212, 0.2);
border-top: 5px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Loader da página */
#pageLoader {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: #f7f7f7;
display: flex;
justify-content: center;
align-items: center;
z-index: 9999;
opacity: 1;
transition: opacity 0.5s ease-out;
}

#pageLoader.hidden {
opacity: 0;
pointer-events: none;
}

.page-spinner {
width: 60px;
height: 60px;
border: 6px solid rgba(131, 242, 212, 0.3);
border-top: 6px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

/* ESTILO DA CAIXA DE RESPOSTA DA IA */
#aiResponse {
display: none;
margin-top: 16px;
padding: 14px;
background: #fff;
border-radius: 12px;
font-size: 14px;
text-align: left;
}

/* ESTILO DO NOVO CABEÇALHO H2 */
#aiResponse h2 {
text-align: center;
color: #6b46c1;
margin-top: 0;
margin-bottom: 16px;
font-size: 18px;
font-weight: bold;
}

/* >>> MUDANÇA AQUI: Estilo do parágrafo com espaçamento <<< */
#aiResponse p {
line-height: 1.6;
margin: 0; /* Reseta a margem */
}

/* Adiciona espaço apenas ENTRE os parágrafos (a partir do segundo) */
#aiResponse p:not(:first-child) {
margin-top: 1em;
}

/* ESTILO PARA OS TÍTULOS DENTRO DA ANÁLISE */
#aiResponse p strong {
color: #6b46c1;
display: block;
margin-top: 18px;
margin-bottom: 8px;
font-size: 15px;
}

  /* ESTILO PARA BOTÃO WHATSAPP */
  #shareButton {
  display: none;            /* continua escondido por padrão */
  width: 60px;
  height: 60px;
  margin: 16px auto 0;
  border-radius: 50%;
  background-color: #25D366;  
  justify-content: center;  /* centraliza horizontal */
  align-items: center;      /* centraliza vertical */
  text-decoration: none;
  transition: background-color 0.2s ease;
}

#shareButton:hover {
  background-color: #128C7E;
}

#shareButton img {
  width: 55px;              /* melhor proporção visual */
  height: 55px;
  display: block;           /* evita espaçamentos fantasmas */
}



#promptBox {
display: none;
margin-top:12px;
padding:10px;
background:#f0f0f5;
border-radius:10px;
font-size:13px;
text-align:left;
}

</style>
</head>

<body>

<!-- Loader da página -->
<div id="pageLoader">
<div class="page-spinner"></div>
</div>

<div class="cards">
<div class="card">
<img id="card1" src="cards_images/back.jpg">
<div class="label">Passado</div>
<div class="card-name" id="name1"></div>
</div>
<div class="card">
<img id="card2" src="cards_images/back.jpg">
<div class="label">Presente</div>
<div class="card-name" id="name2"></div>
</div>
<div class="card">
<img id="card3" src="cards_images/back.jpg">
<div class="label">Futuro</div>
<div class="card-name" id="name3"></div>
</div>
</div>

<button id="actionButton" class="action-button pink">
Embaralhar Cartas
</button>

<div id="status">Aguardando sua consulta</div>
<div id="loader"></div>

<div id="promptBox"></div>

<!-- CAIXA DE RESPOSTA DA IA -->
<div id="aiResponse">
<!-- O conteúdo será inserido aqui pelo JavaScript -->
</div>

<button id="shareButton" aria-label="Compartilhar no WhatsApp">
  <img src="cards_images/zap.png" alt="">
</button>

<script>
const basePath = 'cards_images/';
const backCard = basePath + 'back.jpg';

const cards = [
{ label:'Louco', file:'01_Louco' },
{ label:'Mago', file:'02_Mago' },
{ label:'Sacerdotisa', file:'03_Sacerdotisa' },
{ label:'Imperatriz', file:'04_Imperatriz' },
{ label:'Imperador', file:'05_Imperador' },
{ label:'Sacerdote', file:'06_Sarcedote' },
{ label:'Amantes', file:'07_Amantes' },
{ label:'Carro', file:'08_Carro' },
{ label:'Força', file:'09_Forca' },
{ label:'Eremita', file:'10_Eremita' },
{ label:'Roda da Fortuna', file:'11_Roda' },
{ label:'Justiça', file:'12_Justica' },
{ label:'Enforcado', file:'13_Enforcado' },
{ label:'Morte', file:'14_Morte' },
{ label:'Temperança', file:'15_Temperanca' },
{ label:'Diabo', file:'16_Diabo' },
{ label:'Torre', file:'17_Torre' },
{ label:'Estrela', file:'18_Estrela' },
{ label:'Lua', file:'19_Lua' },
{ label:'Sol', file:'20_Sol' },
{ label:'Julgamento', file:'21_Julgamento' },
{ label:'Mundo', file:'22_Mundo' }
];


const imgs = [
card1 = document.getElementById('card1'),
card2 = document.getElementById('card2'),
card3 = document.getElementById('card3')
];

const labels = [
name1 = document.getElementById('name1'),
name2 = document.getElementById('name2'),
name3 = document.getElementById('name3')
];

const button = document.getElementById('actionButton');
const status = document.getElementById('status');
const loader = document.getElementById('loader');
const aiBox = document.getElementById('aiResponse');
const promptBox = document.getElementById('promptBox');
const shareButton = document.getElementById('shareButton');

let hasReading = false;

function shuffle(arr) {
return arr.sort(() => Math.random() - 0.5);
}

function newReading() {
const shuffled = shuffle([...cards]).slice(0, 3);

shuffled.forEach((card, i) => {
imgs[i].src = `${basePath}${card.file}.jpg`;
labels[i].innerText = card.label;
});

const drawnNames = shuffled.map(c => c.label);

showPrompt(drawnNames);

loader.style.display = 'block';
aiBox.style.display = 'none';
shareButton.style.display = 'none';

callAuroraAPI(drawnNames);

hasReading = true;
button.innerText = 'Nova Consulta';
button.className = 'action-button blue';

status.textContent = 'Consultando…';
status.className = 'status-loading';
}

function showPrompt(drawn) {
const promptBox = document.getElementById('promptBox');
promptBox.style.display = 'block';

}


function resetReading() {
imgs.forEach(img => img.src = backCard);
labels.forEach(l => l.innerText = '');

promptBox.style.display = 'none';
aiBox.style.display = 'none';
shareButton.style.display = 'none';
loader.style.display = 'none';

button.innerText = 'Embaralhar Cartas';
button.className = 'action-button pink';

status.textContent = 'Aguardando sua consulta';
status.className = '';

hasReading = false;
}

function shareOnWhatsApp() {
const analysisText = document.querySelector('#aiResponse p').innerText;
const encodedText = encodeURIComponent(analysisText);
const whatsappUrl = `https://wa.me/?text=${encodedText}`;
window.open(whatsappUrl, '_blank');
}

async function callAuroraAPI(cardsDrawn) {
try {
const res = await fetch(
'https://aurora-api-final-2025.vercel.app/api/chat',
{
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({
messages: [
{
role: "user",
content: `Realize uma análise profunda da situação do consulente, interpretando a sequência de cartas de forma integrada. Examine separadamente os significados do passado, do presente e do futuro e, ao final, construa uma síntese clara, coerente e significativa, conectando os símbolos revelados ao momento vivido pelo consulente.Analise as três cartas sorteadas, estruturando sua resposta em quatro parágrafos distintos. Cada parágrafo deve ter um título em negrito. Siga exatamente esta estrutura:

**Passado:**
Escreva aqui sua análise sobre a carta ${cardsDrawn[0]} e sua influência no passado do consulente.

**Presente:**
Escreva aqui sua análise sobre a carta ${cardsDrawn[1]} e sua influência no presente do consulente.

**Futuro:**
Escreva aqui sua análise sobre a carta ${cardsDrawn[2]} e sua influência no futuro do consulente.

**Análise Final:**
Escreva aqui uma síntese final, conectando as três cartas e oferecendo uma orientação clara e integrada para o consulente.`
}
]
})
}
);

console.log('Status da Resposta da API:', res.status);
const data = await res.json();
console.log('Resposta Completa da API:', data);

const analysisText = data.choices[0].message.content || 'A IA não retornou um texto.';

aiBox.innerHTML = `<h2>Anora Assistente de IA</h2><p>${analysisText}</p>`;

status.textContent = 'Consulta realizada';
status.className = 'status-success';

} catch (error) {
console.error('Erro na chamada da API:', error);
const errorText = 'Erro ao acessar a reflexão.';

aiBox.innerHTML = `<h2>Anora Assistente de IA</h2><p>${errorText}</p>`;

status.textContent = 'Erro de carregamento';
status.className = 'status-error';
}

loader.style.display = 'none';
aiBox.style.display = 'block';
shareButton.style.display = 'block';
}

// Lógica para esconder o loader da página
window.addEventListener('load', () => {
setTimeout(() => {
const pageLoader = document.getElementById('pageLoader');
if (pageLoader) {
pageLoader.classList.add('hidden');
}
}, 2000);
});

shareButton.onclick = shareOnWhatsApp;

button.onclick = () => hasReading ? resetReading() : newReading();
</script>

<script>
if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('/service-worker.js')
.then(() => console.log('SW registrado'))
.catch(err => console.error('SW erro:', err));
});
}
</script>

</body>
</html>
