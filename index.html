<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#6b46c1">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

<title>Anora Tar√¥</title>
<style>
body {
margin: 0;
padding: 20px;
font-family: Arial, sans-serif;
background: #f7f7f7;
text-align: center;
}

.cards {
display: flex;
justify-content: center;
gap: 12px;
margin-bottom: 24px;
}

.card { width: 90px; }

.card img {
width: 100%;
border-radius: 10px;
box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.label { margin-top: 6px; font-size: 13px; font-weight: bold; }

.card-name { font-size: 11px; color: #6b46c1; min-height: 14px; }

.action-button {
width: 100%;
max-width: 320px;
height: 50px;
border: none;
border-radius: 4px;
font-size: 18px;
font-weight: bold;
color: #fff;
cursor: pointer;
transition: transform 0.2s ease;
}

.action-button:active { transform: scale(0.98); }
.pink { background:#fd98be; }
.blue { background:#98e6ce; }

#status {
margin-top: 16px;
font-weight: bold;
color: #718096;
}

#status.status-loading { color: #6b46c1; }
#status.success { color: #38a169; }
#status.error { color: #e53e3e; }

/* Loader de consulta √† API */
#loader {
display: none;
margin: 20px auto;
width: 50px;
height: 50px;
border: 5px solid rgba(131, 242, 212, 0.2);
border-top: 5px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

/* Loader Inicial da P√°gina */
#pageLoader {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: #f7f7f7;
display: flex;
justify-content: center;
align-items: center;
z-index: 9999;
}

.hidden { display: none !important; }

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.page-spinner {
width: 60px;
height: 60px;
border: 6px solid rgba(131, 242, 212, 0.3);
border-top: 6px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

#aiResponse {
display: none;
margin-top: 16px;
padding: 14px;
background: #fff;
border-radius: 12px;
font-size: 14px;
text-align: left;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#aiResponse h2 { text-align: center; color: #6b46c1; font-size: 18px; margin-top: 0; }
#aiResponse p { line-height: 1.6; color: #2d3748; }

#shareButton {
display: none;
width: 60px;
height: 60px;
margin: 16px auto 0;
border-radius: 50%;
background-color: #25D366;
justify-content: center;
align-items: center;
text-decoration: none;
}

#shareButton img { width: 50px; height: 50px; }

#promptBox {
display: none;
margin-top: 12px;
padding: 10px;
background: #f0f0f5;
border-radius: 10px;
font-size: 13px;
text-align: left;
}

/* Estilo para a mensagem de "copiado" */
#copyAlert {
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
background-color: #333;
color: white;
padding: 10px 20px;
border-radius: 8px;
font-size: 14px;
font-family: Arial, sans-serif;
z-index: 10000;
opacity: 0;
visibility: hidden;
transition: opacity 0.3s ease-in-out;
}

#copyAlert.show {
opacity: 1;
visibility: visible;
}
</style>
</head>
<body>

<div id="pageLoader">
<div class="page-spinner"></div>
</div>

<!-- Caixa de alerta para o feedback -->
<div id="copyAlert">Texto copiado!</div>

<div class="cards">
<div class="card">
<img id="card1" src="cards_images/back.jpg" alt="Carta 1">
<div class="label">Passado</div>
<div class="card-name" id="name1"></div>
</div>
<div class="card">
<img id="card2" src="cards_images/back.jpg" alt="Carta 2">
<div class="label">Presente</div>
<div class="card-name" id="name2"></div>
</div>
<div class="card">
<img id="card3" src="cards_images/back.jpg" alt="Carta 3">
<div class="label">Futuro</div>
<div class="card-name" id="name3"></div>
</div>
</div>

<button id="actionButton" class="action-button pink">‚ú® Consultar Cartas</button>

<div id="status">Aguardando sua consulta</div>
<div id="loader"></div>
<div id="promptBox"></div>
<div id="aiResponse"></div>

<!-- Bot√£o de compartilhar, agora √© um div para ter mais controle -->
<div id="shareButton" onclick="shareOnWhatsApp()">
<img src="cards_images/zap.png" alt="WhatsApp">
</div>

<script>
// Fun√ß√£o para esconder o loader
function hidePageLoader() {
const pageLoader = document.getElementById('pageLoader');
if (pageLoader) {
pageLoader.classList.add('hidden');
}
}

// Um temporizador de SEGURAN√áA.
setTimeout(hidePageLoader, 3000);

// Todo o resto do c√≥digo √© executado APENAS quando o DOM est√° pronto.
document.addEventListener('DOMContentLoaded', () => {
console.log("DOM carregado. Iniciando o aplicativo.");

const basePath = 'cards_images/';
const backCard = basePath + 'back.jpg';

const cards = [
{ label:'Louco', file:'01_Louco' }, { label:'Mago', file:'02_Mago' },
{ label:'Sacerdotisa', file:'03_Sacerdotisa' }, { label:'Imperatriz', file:'04_Imperatriz' },
{ label:'Imperador', file:'05_Imperador' }, { label:'Sacerdote', file:'06_Sacerdote' },
{ label:'Amantes', file:'07_Amantes' }, { label:'Carro', file:'08_Carro' },
{ label:'For√ßa', file:'09_Forca' }, { label:'Eremita', file:'10_Eremita' },
{ label:'Roda da Fortuna', file:'11_Roda' }, { label:'Justi√ßa', file:'12_Justica' },
{ label:'Enforcado', file:'13_Enforcado' }, { label:'Morte', file:'14_Morte' },
{ label:'Temperan√ßa', file:'15_Temperanca' }, { label:'Diabo', file:'16_Diabo' },
{ label:'Torre', file:'17_Torre' }, { label:'Estrela', file:'18_Estrela' },
{ label:'Lua', file:'19_Lua' }, { label:'Sol', file:'20_Sol' },
{ label:'Julgamento', file:'21_Julgamento' }, { label:'Mundo', file:'22_Mundo' }
];

const imgs = [
document.getElementById('card1'),
document.getElementById('card2'),
document.getElementById('card3')
];

const labels = [
document.getElementById('name1'),
document.getElementById('name2'),
document.getElementById('name3')
];

const button = document.getElementById('actionButton');
const status = document.getElementById('status');
const loader = document.getElementById('loader');
const aiBox = document.getElementById('aiResponse');
const promptBox = document.getElementById('promptBox');
const shareButton = document.getElementById('shareButton');
const copyAlert = document.getElementById('copyAlert');

let hasReading = false;

function shuffle(arr) {
const shuffled = [...arr];
for (let i = shuffled.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
}
return shuffled;
}

function newReading() {
const shuffled = shuffle(cards).slice(0, 3);
shuffled.forEach((card, i) => {
imgs[i].src = `${basePath}${card.file}.jpg`;
labels[i].innerText = card.label;
});
const drawnNames = shuffled.map(c => c.label);
showPrompt(drawnNames);
loader.style.display = 'block';
aiBox.style.display = 'none';
shareButton.style.display = 'flex';
callAuroraAPI(drawnNames);
hasReading = true;
button.innerText = 'üîÑ Nova Consulta';
button.className = 'action-button blue';
status.textContent = 'Consultando a IA...';
status.className = 'status-loading';
}

function showPrompt(drawn) {
promptBox.style.display = 'block';
promptBox.innerHTML = `
<strong>üìú Cartas Selecionadas:</strong><br><br>
<strong>Passado:</strong> ${drawn[0]}<br>
<strong>Presente:</strong> ${drawn[1]}<br>
<strong>Futuro:</strong> ${drawn[2]}
`;
}

function resetReading() {
imgs.forEach(img => img.src = backCard);
labels.forEach(l => l.innerText = '');
promptBox.style.display = 'none';
aiBox.style.display = 'none';
shareButton.style.display = 'none';
loader.style.display = 'none';
button.innerText = '‚ú® Consultar Cartas';
button.className = 'action-button pink';
status.textContent = 'Aguardando sua consulta';
status.className = '';
hasReading = false;
}

// >>> FUN√á√ÉO DE COMPARTILHAR ATUALIZADA (M√âTODO SEGURO) <<<
function shareOnWhatsApp() {
// 1. Pega o texto do t√≠tulo e da an√°lise
const titleText = document.querySelector('#aiResponse h2').innerText;
const analysisText = document.querySelector('#aiResponse p').innerText;
const fullText = `${titleText}\n\n${analysisText}`;

// 2. Cria um elemento de input tempor√°rio e o esconde fora da tela
const tempInput = document.createElement('input');
tempInput.value = fullText;
document.body.appendChild(tempInput);
tempInput.select();
tempInput.setSelectionRange(0, 99999); // Seleciona todo o texto

// 3. Executa o comando de copiar
document.execCommand('copy');

// 4. Remove o elemento tempor√°rio
document.body.removeChild(tempInput);

// 5. Mostra uma mensagem de feedback para o usu√°rio
showCopyAlert();
}

function showCopyAlert() {
copyAlert.classList.add('show');
setTimeout(() => {
copyAlert.classList.remove('show');
}, 2000); // A mensagem some ap√≥s 2 segundos
}

async function callAuroraAPI(cardsDrawn) {
try {
const res = await fetch('https://aurora-api-final-2025.vercel.app/api/chat', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({
model: 'llama-3.3-70b-versatile',
messages: [{ role: "user", content: `Analise as tr√™s cartas sorteadas, estruturando sua resposta em quatro par√°grafos distintos. Cada par√°grafo deve ter um t√≠tulo em negrito. Siga exatamente esta estrutura: **Passado:** Escreva aqui sua an√°lise sobre a carta ${cardsDrawn[0]} e sua influ√™ncia no passado do consulente. **Presente:** Escreva aqui sua an√°lise sobre a carta ${cardsDrawn[1]} e sua influ√™ncia no presente do consulente. **Futuro:** Escreva aqui sua an√°lise sobre a carta ${cardsDrawn[2]} e sua influ√™ncia no futuro do consulente. **An√°lise Final:** Escreva aqui uma s√≠ntese final, conectando as tr√™s cartas e oferecendo uma orienta√ß√£o clara e integrada para o consulente.` }],
temperature: 0.7, max_tokens: 500
})
});
if (!res.ok) throw new Error(`Erro HTTP: ${res.status}`);
const data = await res.json();
const analysisText = data.choices?.[0]?.message?.content || 'A IA n√£o retornou nenhuma an√°lise.';
aiBox.innerHTML = `<h2>üîÆ Anora Assistente de IA</h2><p>${analysisText}</p>`;
status.textContent = '‚úÖ Consulta realizada';
status.className = 'success';
} catch (error) {
const errorText = `Erro ao consultar a IA: ${error.message}`;
aiBox.innerHTML = `<h2>‚ö†Ô∏è Erro</h2><p>${errorText}</p>`;
status.textContent = 'Erro ao consultar';
status.className = 'error';
}
loader.style.display = 'none';
aiBox.style.display = 'block';
shareButton.style.display = 'flex';
}

shareButton.onclick = shareOnWhatsApp;
button.onclick = () => hasReading ? resetReading() : newReading();
hidePageLoader();
});
</script>

</body>
</html>
