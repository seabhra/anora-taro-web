<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Anora Tarô</title>

<style>
body {
  margin: 0;
  padding: 20px;
  font-family: Arial, Helvetica, sans-serif;
  background: #f7f7f7;
  text-align: center;
}

.cards {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 24px;
}

.card { width: 90px; }

.card img {
  width: 100%;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.label {
  margin-top: 6px;
  font-size: 13px;
  font-weight: bold;
}

.card-name {
  font-size: 13px;
  color: #6b46c1;
  min-height: 14px;
}

.action-button {
  width: 100%;
  max-width: 320px;
  height: 50px;
  border: none;
  border-radius: 4px;
  font-size: 18px;
  font-weight: bold;
  color: #fff;
  cursor: pointer;
}

.pink { background:#fd98be; }
.blue { background:#98e6ce; }

/* Estilo padrão do status */
#status {
  margin-top: 16px;
  font-weight: bold;
  color: #718096;
  transition: color 0.3s ease;
}

/* Classes para as cores do status */
#status.status-loading {
  color: #6b46c1; /* Roxo */
}

#status.status-success {
  color: #38a169; /* Verde */
}

#status.status-error {
  color: #3182ce; /* Azul */
}

/* Loader da API (o antigo) */
#loader {
  display: none;
  margin: 20px auto;
  width: 50px;
  height: 50px;
  border: 5px solid rgba(131, 242, 212, 0.2);
  border-top: 5px solid #83f2d4;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* >>> ESTILO DO NOVO LOADER DE PÁGINA <<< */
#pageLoader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #f7f7f7; /* Cor de fundo da tela de carregamento */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* Fica por cima de tudo */
  opacity: 1;
  transition: opacity 0.5s ease-out; /* Efeito de sumir suavemente */
}

#pageLoader.hidden {
  opacity: 0;
  pointer-events: none; /* Impede que o usuário clique nele enquanto some */
}

/* Spinner do loader da página */
.page-spinner {
  width: 60px;
  height: 60px;
  border: 10px solid rgba(131, 242, 212, 0.3);
  border-top: 6px solid #83f2d4; /* Cor verde que você pediu */
  border-radius: 50%;
  animation: spin 1s linear infinite;
}


#promptBox {
  display: none;
  margin-top:12px;
  padding:10px;
  background:#f0f0f5;
  border-radius:10px;
  font-size:13px;
  text-align:left;
}

#aiResponse {
  display: none;
  margin-top: 16px;
  padding: 14px;
  background: #fff;
  border-radius: 12px;
  font-size: 14px;
  text-align: left;
}
</style>
</head>

<body>

<!-- >>> NOVO LOADER DE PÁGINA <<< -->
<div id="pageLoader">
  <div class="page-spinner"></div>
</div>
<!-- >>> FIM DO NOVO LOADER <<< -->

<div class="cards">
  <div class="card">
    <img id="card1" src="cards_images/back.jpg">
    <div class="label">Passado</div>
    <div class="card-name" id="name1"></div>
  </div>
  <div class="card">
    <img id="card2" src="cards_images/back.jpg">
    <div class="label">Presente</div>
    <div class="card-name" id="name2"></div>
  </div>
  <div class="card">
    <img id="card3" src="cards_images/back.jpg">
    <div class="label">Futuro</div>
    <div class="card-name" id="name3"></div>
  </div>
</div>

<button id="actionButton" class="action-button pink">
Embaralhar Cartas
</button>

<div id="status">Aguardando sua consulta</div>
<div id="loader"></div>

<div id="promptBox"></div>
<div id="aiResponse"></div>

<script>
const basePath = 'cards_images/';
const backCard = basePath + 'back.jpg';

const cards = [
  { label:'Louco', file:'01_Louco' },
  { label:'Mago', file:'02_Mago' },
  { label:'Sacerdotisa', file:'03_Sacerdotisa' },
  { label:'Imperatriz', file:'04_Imperatriz' },
  { label:'Imperador', file:'05_Imperador' },
  { label:'Sacerdote', file:'06_Sarcedote' },
  { label:'Amantes', file:'07_Amantes' },
  { label:'Carro', file:'08_Carro' },
  { label:'Força', file:'09_Forca' },
  { label:'Eremita', file:'10_Eremita' },
  { label:'Roda da Fortuna', file:'11_Roda' },
  { label:'Justiça', file:'12_Justica' },
  { label:'Enforcado', file:'13_Enforcado' },
  { label:'Morte', file:'14_Morte' },
  { label:'Temperança', file:'15_Temperanca' },
  { label:'Diabo', file:'16_Diabo' },
  { label:'Torre', file:'17_Torre' },
  { label:'Estrela', file:'18_Estrela' },
  { label:'Lua', file:'19_Lua' },
  { label:'Sol', file:'20_Sol' },
  { label:'Julgamento', file:'21_Julgamento' },
  { label:'Mundo', file:'22_Mundo' }
];


const imgs = [
 card1 = document.getElementById('card1'),
 card2 = document.getElementById('card2'),
 card3 = document.getElementById('card3')
];

const labels = [
 name1 = document.getElementById('name1'),
 name2 = document.getElementById('name2'),
 name3 = document.getElementById('name3')
];

const button = document.getElementById('actionButton');
const status = document.getElementById('status');
const loader = document.getElementById('loader');
const aiBox = document.getElementById('aiResponse');
const promptBox = document.getElementById('promptBox');

let hasReading = false;

function shuffle(arr) {
 return arr.sort(() => Math.random() - 0.5);
}

function newReading() {
  const shuffled = shuffle([...cards]).slice(0, 3);

  shuffled.forEach((card, i) => {
    imgs[i].src = `${basePath}${card.file}.jpg`;
    labels[i].innerText = card.label;
  });

  const drawnNames = shuffled.map(c => c.label);

  showPrompt(drawnNames);
  
  loader.style.display = 'block'; 
  aiBox.style.display = 'none';

  callAuroraAPI(drawnNames);

  hasReading = true;
  button.innerText = 'Nova Consulta';
  button.className = 'action-button blue';
  
  status.textContent = 'Consultando…';
  status.className = 'status-loading';
}

   function showPrompt(drawn) {
  const promptBox = document.getElementById('promptBox');
  promptBox.style.display = 'block';
 
}


function resetReading() {
 imgs.forEach(img => img.src = backCard);
 labels.forEach(l => l.innerText = '');

 promptBox.style.display = 'none';
 aiBox.style.display = 'none';
 loader.style.display = 'none';

 button.innerText = 'Embaralhar Cartas';
 button.className = 'action-button pink';
 
 status.textContent = 'Aguardando sua consulta';
 status.className = '';

 hasReading = false;
}

async function callAuroraAPI(cardsDrawn) {
 try {
   const res = await fetch(
     'https://aurora-api-final-2025.vercel.app/api/chat',
     {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({
         messages: [
           {
             role: "user",
             content: `Leitura simbólica de Tarô:
Passado: ${cardsDrawn[0]}
Presente: ${cardsDrawn[1]}
Futuro: ${cardsDrawn[2]}`
           }
         ]
       })
     }
   );

   console.log('Status da Resposta da API:', res.status);
   const data = await res.json();
   console.log('Resposta Completa da API:', data);

   aiBox.innerText = data.choices[0].message.content || 'A IA não retornou um texto.';
   
   status.textContent = 'Consulta realizada';
   status.className = 'status-success';

 } catch (error) {
   console.error('Erro na chamada da API:', error);
   aiBox.innerText = 'Erro ao acessar a reflexão.';
   
   status.textContent = 'Erro de carregamento';
   status.className = 'status-error';
 }

 loader.style.display = 'none';
 aiBox.style.display = 'block';
}

// >>> LÓGICA PARA ESCONDER O LOADER DA PÁGINA <<< -->
window.addEventListener('load', () => {
  // Espera 2 segundos (2000 milissegundos) depois que a página carregar
  setTimeout(() => {
    const pageLoader = document.getElementById('pageLoader');
    if (pageLoader) {
      pageLoader.classList.add('hidden');
    }
  }, 2000); // Mude este valor para mais ou menos tempo
});
  
button.onclick = () => hasReading ? resetReading() : newReading();
</script>

</body>
</html>


