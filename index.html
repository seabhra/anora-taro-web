<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <!-- 1. SCRIPT PRINCIPAL DO ADMOB -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
            crossorigin="anonymous"></script>
  
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#6b46c1">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

  
<title>Anora Tar√¥</title>

<style>
 
body {
margin: 0;
padding: 20px;
font-family: Arial, Helvetica, sans-serif;
background: #f7f7f7;
text-align: center;
}

.cards {
display: flex;
justify-content: center;
gap: 12px;
margin-bottom: 24px;
}

.card { width: 90px; }

.card img {
width: 100%;
border-radius: 10px;
box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.flors {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 16px 0;
}

.flor {
  width: 70px;
  height: auto;
}

.flor img {
  width: 100%;
  height: auto;
  display: block;
  box-shadow: none;
  border-radius: 0;
  background: transparent;
}

/* Container */
#cabalaBox {
  display: none; /* come√ßa oculto */
  justify-content: center;
  align-items: center;
  margin: 16px 0;
  animation: fadeIn 0.6s ease;
}

/* Imagem */
#cabalaBox img {
  width: 80px;          /* üëà tamanho real */
  height: auto;
  animation: spin 2.4s linear infinite; /* üê¢ mais lento */
  opacity: 0.9;
  display: block;       /* üëà ESSENCIAL */
}

/* Anima√ß√£o */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}

      
.label {
margin-top: 6px;
font-size: 13px;
font-weight: bold;
}

.card-name {
font-size: 11px;
color: #6b46c1;
min-height: 14px;
}

.action-button {
width: 100%;
max-width: 320px;
height: 50px;
border: none;
border-radius: 4px;
font-size: 18px;
font-weight: bold;
color: #fff;
cursor: pointer;
}

/* Status da cor do bot√£o */
  
.pink { background:#fd98be; }
.roxo { background:#de86e5 }
.blue { background:#98e6ce; }

/* Estilo marca anora na mensagem compartilhada */
  
  .ai-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Shape arredondado */
.ai-logo {
  width: 26px;
  height: 26px;
  padding: 6px;
  background: #f3e8ff;           /* lil√°s suave */
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
      
/* Estilo padr√£o do status */
#status {
margin-top: 16px;
font-weight: bold;
color: #718096;
transition: color 0.3s ease;
}
/* status da mudan√ßa de cores da label abaixo do bot√£o*/

#status.status-process {
color: #4d0567; /* Roxinho */
}
#status.status-loading {
color: #1383c9; /* Azul */
}
#status.status-success {
color: #38a169; /* Verde */
}
#status.status-error {
color: #ce3149; /* Vermelho */
}

/* Loader da API */
#loader {
display: none;
margin: 20px auto;
width: 50px;
height: 50px;
border: 5px solid rgba(131, 242, 212, 0.2);
border-top: 5px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Loader da p√°gina */
#pageLoader {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: #f7f7f7;
display: flex;
justify-content: center;
align-items: center;
z-index: 9999;
opacity: 1;
transition: opacity 0.5s ease-out;
}

#pageLoader.hidden {
opacity: 0;
pointer-events: none;
}

.page-spinner {
width: 60px;
height: 60px;
border: 6px solid rgba(131, 242, 212, 0.3);
border-top: 6px solid #83f2d4;
border-radius: 50%;
animation: spin 1s linear infinite;
}

/* ESTILO DA CAIXA DE RESPOSTA DA IA */
#aiBox { /* CORRE√á√ÉO: ID unificado para aiBox */
display: none;
margin-top: 16px;
padding: 5px;
background: #fff;
border-radius: 12px;
font-size: 16px;
text-align: center;
}

/* ESTILO DO NOVO CABE√áALHO COMPARTILHADO H2 */
#aiBox h2 {
text-align: center;
color: #6b46c1;
margin-top: 0;
margin-bottom: 16px;
font-size: 18px;
font-weight: bold;
}

/* Estilo do par√°grafo com espa√ßamento <<< */
#aiBox p {
line-height: 1.6;
margin: 0; /* Reseta a margem */
}

/* Adiciona espa√ßo apenas ENTRE os par√°grafos (a partir do segundo) */
  
#aiBox p:not(:first-child) {
margin-top: 1em;
}

/* ESTILO PARA OS T√çTULOS DENTRO DA AN√ÅLISE */
#aiBox p strong {
color: #6b46c1;
display: block;
margin-top: 18px;
margin-bottom: 8px;
font-size: 15px;
}

 /* ESTILO PARA BOT√ÉO WHATSAPP */

#shareButton {
  width: 100%;
  max-width: 320px;
  height: 45px;
  margin: 12px auto 0;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #fff;
  background-color: #25D366;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.2s ease;
}

/* Estado oculto */
#shareButton.hidden {
  display: none;
}

/* Hover elegante */
#shareButton:hover {
  background-color: #128C7E;
  transform: scale(1.02);
}

/* Feedback de clique */
#shareButton:active {
  transform: scale(0.98);
}

/* Efeito de vibra√ß√£o/giro das cartas */
.card-spinning {
    animation: spinEffect 0.15s infinite linear;
    filter: blur(1px); /* Leve desfoque para dar sensa√ß√£o de velocidade */
}

@keyframes spinEffect {
    0% { transform: translateY(-5px); }
    50% { transform: translateY(5px); }
    100% { transform: translateY(-5px); }
}
 /* CONTROLE DE ESPA√áO EMOJI FORA JS */
    
 .btn-emoji {
  margin-right: 8px;
}
 /* CONTROLE DE ESPA√áO EMOJI DENTRO DO JS */

      /* 1. Define a anima√ß√£o de rota√ß√£o (giro de 360 graus) */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.status-emoji {
  margin-right: 8px; /* Define o espa√ßamento √† direita */
  display: inline-block; /* ESSENCIAL para a margem funcionar */
  vertical-align: middle; /* Alinha o emoji verticalmente com o texto */
}

.status-text {
 vertical-align: middle;
}

.status-emoji.giro {
  margin-right: 8px;
  display: inline-block; /* Necess√°rio para a anima√ß√£o funcionar bem em spans */
  animation: spin 0.6s linear infinite;
}
  
 
/* Container do AdMob Google */
#ad-container {
  margin-top: 24px;
  width: 100%;
  min-height: 0;   /* üëà altura m√≠nima realista */
  text-align: center;
  display: none;     /* come√ßa escondido */
 border: 1px dashed red; /* debug visual */
}
 
 
</style>
</head>

<body>

<!-- Loader da p√°gina -->
           
<div id="pageLoader">
<div class="page-spinner"></div>
</div>

<div class="cards">
<div class="card">
<img id="card1" src="cards_images/back.jpg">
<div class="label">Passado</div>
<div class="card-name" id="name1"></div>
</div>
<div class="card">
<img id="card2" src="cards_images/back.jpg">
<div class="label">Presente</div>
<div class="card-name" id="name2"></div>
</div>
<div class="card">
<img id="card3" src="cards_images/back.jpg">
<div class="label">Futuro</div>
<div class="card-name" id="name3"></div>
</div>
</div>

<button id="actionButton" class="action-button pink">
  <span class="btn-emoji">üîÆ</span>
  <span>Embaralhar Cartas</span>
</button>

  <!-- LABEL AGUARDANDO SUA CONSULTA -->
  <div id="status">
  <span class="status-emoji"></span>
  <span class="status-text">Aguardando sua consulta...</span>
  </div>
  
 <!-- LOCAL DA FLOR DE LIZ -->
  
<div class="flors" id="florBox">
  <div class="flor">
    <img src="cards_images/liz.png" alt="Flor simb√≥lica">
  </div>
</div>

<div id="cabalaBox" style="display:none;">
  <img src="cards_images/cabala.png" alt="Cabala">
</div>

      
<div id="loader"></div>

<!-- LOCAL DO PROMPT DA IA -->
  
<div id="promptBox"></div>

<!-- LOCAL Compartilhar no WhatsApp e An√∫ncio -->

<div id="aiBox" style="display: none;">
  <!-- conte√∫do do prompt da IA entra aqui -->

  <!-- üëá FICA FIXO, N√ÉO √â RECRIADO -->
  <div id="ad-container">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3940256099942544"
         data-ad-slot="6300978111"
         data-ad-format="auto"
         data-full-width-responsive="true">
    </ins>
  </div>
</div


   

  
 <!--  CORPO DO JS DO APLICATIVO  -->
  
<script>
// ===================================================================
// SCRIPT PRINCIPAL - OR√ÅCULO ANORA TAR√î (VERS√ÉO FINAL CORRIGIDA)
// ===================================================================

let hasReading = false;
let isResetting = false;
      
document.addEventListener('DOMContentLoaded', () => {

  // ---------------- ELEMENTOS DO DOM ----------------
  const button = document.getElementById('actionButton');
  const status = document.getElementById('status');
  const loader = document.getElementById('loader');
  const aiBox = document.getElementById('aiBox');
  const promptBox = document.getElementById('promptBox');
  const florBox = document.getElementById('florBox');
 const cabalaBox = document.getElementById('cabalaBox');
  const pageLoader = document.getElementById('pageLoader');

  const imgs = [
    document.getElementById('card1'),
    document.getElementById('card2'),
    document.getElementById('card3')
  ].filter(Boolean);

  const labels = [
    document.getElementById('name1'),
    document.getElementById('name2'),
    document.getElementById('name3')
  ].filter(Boolean);

  // ---------------- ESTADO ----------------
  let hasReading = false;
  const basePath = 'cards_images/';
  const backCard = basePath + 'back.jpg';

  // ---------------- √ÅUDIO ----------------
  const shuffleAudio = new Audio('Audio_app/slots_machine.mp3');
  shuffleAudio.preload = 'auto';

  const memoriesAudio = new Audio('./Audio_app/memories.mp3');
  memoriesAudio.loop = true; // Define que o √°udio deve tocar em loop
  memoriesAudio.preload = 'auto';    

  // ---------------- CARTAS ----------------
  const cards = [
    { label:'Louco', file:'01_Louco' }, { label:'Mago', file:'02_Mago' },
    { label:'Sacerdotisa', file:'03_Sacerdotisa' }, { label:'Imperatriz', file:'04_Imperatriz' },
    { label:'Imperador', file:'05_Imperador' }, { label:'Sacerdote', file:'06_Sacerdote' },
    { label:'Amantes', file:'07_Amantes' }, { label:'Carro', file:'08_Carro' },
    { label:'For√ßa', file:'09_Forca' }, { label:'Eremita', file:'10_Eremita' },
    { label:'Roda da Fortuna', file:'11_Roda' }, { label:'Justi√ßa', file:'12_Justica' },
    { label:'Enforcado', file:'13_Enforcado' }, { label:'Morte', file:'14_Morte' },
    { label:'Temperan√ßa', file:'15_Temperanca' }, { label:'Diabo', file:'16_Diabo' },
    { label:'Torre', file:'17_Torre' }, { label:'Estrela', file:'18_Estrela' },
    { label:'Lua', file:'19_Lua' }, { label:'Sol', file:'20_Sol' },
    { label:'Julgamento', file:'21_Julgamento' }, { label:'Mundo', file:'22_Mundo' }
  ];

  // ---------------- FUN√á√ïES ----------------
const shuffle = arr => arr.sort(() => Math.random() - 0.5);

function newReading() {
        
// Para e reseta a m√∫sica de fundo se uma nova leitura come√ßar
    if (memoriesAudio) {
      memoriesAudio.pause();
      memoriesAudio.currentTime = 0;
    }
florBox && (florBox.style.display = 'none');
      
// üëâ MOSTRA A IMAGEM AO CLICAR
  if (cabalaBox) {
    cabalaBox.style.display = 'flex';
    cabalaBox.style.justifyContent = 'center';
    cabalaBox.style.alignItems = 'center';
  }

  aiBox.style.display = 'none';
  promptBox.style.display = 'none';
  loader.style.display = 'none';
      
  shuffleAudio.currentTime = 0;
  shuffleAudio.play().catch(() => {});

  button.className = 'action-button roxo';

button.innerHTML = `<span class="status-emoji giro">üåÄ</span><span class="status-text">Embaralhando Cartas</span>`;

  status.textContent = 'Sua previs√£o em andamento...';
  status.className = 'status-process';

  // 3. INCIA ANIMA√á√ÉO VISUAL DAS CARTAS
  imgs.forEach(img => img.classList.add('card-spinning'));
  labels.forEach(l => l.innerText = 'Sorteando');



  const spin = setInterval(() => {
    imgs.forEach(img => {
      const r = cards[Math.floor(Math.random() * cards.length)];
      img.src = `${basePath}${r.file}.jpg`;
    });
  }, 80);

  setTimeout(() => {
    clearInterval(spin);
    shuffleAudio.pause();

    const drawn = shuffle([...cards]).slice(0, 3);
    drawn.forEach((c, i) => {
      imgs[i].src = `${basePath}${c.file}.jpg`;
      labels[i].innerText = c.label;
      imgs[i].classList.remove('card-spinning');
    });

    loader.style.display = 'block';
    status.innerHTML = `<span class="status-emoji">ü§ñ</span><span class="status-text">Processando consulta com IA...</span>`;
    status.className = 'status-loading'; 

    callAuroraAPI(drawn.map(c => c.label));

    hasReading = true;
    button.className = 'action-button blue';
    button.innerHTML = `<span class="btn-emoji">üîÑ</span><span class="status-text">Nova Consulta</span>`;
    cabalaBox && (cabalaBox.style.display = 'none'); // Esconde a cabala ao final do sorteio

        
   showPrompt(drawn.map(c => c.label));
   cabalaBox && (cabalaBox.style.display = 'none');

        
  }, 7500);
}

function showPrompt(drawn) {
  const pBox = document.getElementById('promptBox');
  if (pBox) {
    pBox.style.display = 'block';
    pBox.innerHTML = `<strong>üìú Cartas:</strong> ${drawn.join(' | ')}`;
  }
}
function clearPrompt() {
  if (!promptBox) return;
  promptBox.innerHTML = '';
  promptBox.style.display = 'none';
}
      
function resetReading() {
  isResetting = true;

  imgs.forEach(img => img.src = backCard);
  labels.forEach(l => l.innerText = '');

  clearPrompt();

  aiBox.style.display = 'none';
  loader.style.display = 'none';

if (cabalaBox) {
  cabalaBox.style.display = 'none';
}
florBox && (florBox.style.display = 'flex');
  button.innerHTML = `<span class="btn-emoji">üîÆ</span><span>Embaralhar Cartas</span>`;
  button.className = 'action-button pink';
  button.disabled = false;

  status.innerHTML = `<span class="status-text">Aguardando sua consulta...</span>`;
  status.className = '';

aiBox.style.display = 'none';

const adContainer = document.getElementById('ad-container');
if (adContainer) {
  adContainer.style.display = 'none';
}

// ---------------- DELETA AUDIO ----------------
      
if (memoriesAudio) {
  memoriesAudio.pause();
  memoriesAudio.currentTime = 0;
}
   hasReading = false;
  isResetting = false
}

function shareOnWhatsApp() {
  const title = document.querySelector('#aiBox h2')?.innerText?.trim() || 'Anora Tar√¥';
  const analysisText = document.querySelector('#aiBox p')?.innerText?.trim() || '';

  if (!analysisText) {
    console.warn('Nenhum texto de an√°lise encontrado para compartilhar.');
    return;
  }
  const WHATSAPP_FOOTER = "\n\nüîÆ Anora Tar√¥ ‚Äî leitura assistida por IA\n‚ö° Powered by Geraldo A. Seabra";
  const message = `‚ú® ${title}\n\n${analysisText}${WHATSAPP_FOOTER}`;

  try {
    if (window.AppInventor && typeof window.AppInventor.setWebViewString === 'function') {
      window.AppInventor.setWebViewString(message);
    } else {
      const encodedMessage = encodeURIComponent(message);
      const whatsappUrl = `https://api.whatsapp.com/send?text=${encodedMessage}`;
      window.open(whatsappUrl, '_blank');
    }
  } catch (error) {
    console.error("Erro ao tentar compartilhar no WhatsApp:", error);
  }
}

        // ---------------- ELEMENTOS DO DOM API ----------------
      
async function callAuroraAPI(cardsDrawn) {
      
// ---------------- TOCA √ÅUDIO ----------------
  try {
memoriesAudio.currentTime = 0;
  memoriesAudio.play();
} catch (e) {
  console.warn('√Åudio bloqueado pelo navegador:', e);
}
    const res = await fetch('https://aurora-api-final-2025.vercel.app/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        messages: [{
          role: "user",
          content: `Interprete as cartas ${cardsDrawn.join(', ')}`
        }]
      })
    });
    const data = await res.json();
        if (isResetting) return;
    const text = data.choices?.[0]?.message?.content || 'Sem resposta.';


      aiBox.innerHTML = `
      <h2 class="ai-title">
        <img src="cards_images/marca_anora.png" class="ai-logo">
        Anora Assistente de IA
      </h2>
      <p>${text}</p>
      <button id="shareButton" class="action-button">Compartilhar no WhatsApp</button>
      <div id="ad-container">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3940256099942544"
             data-ad-slot="6300978111"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    `;
    status.innerHTML = `<span class="status-emoji">‚úÖ</span><span class="status-text">Consulta realizada com sucesso</span>`;
 
        
    status.className = 'status-success';
  } catch (error) {
    console.error('Erro na chamada da API:', error);
    aiBox.innerHTML = `<p>Erro ao acessar a reflex√£o.</p>`;
    status.textContent = 'Erro de acessar an√°lise feita pelo sistema.';
    status.className = 'status-error';
  }
  loader.style.display = 'none';
  // >>> PONTO CHAVE: MOSTRANDO O AIBox E O AN√öNCIO <<<
  aiBox.style.display = 'block';

  // CORRE√á√ÉO: Encontra o container do an√∫ncio (que agora est√° dentro do aiBox)
  // e o torna vis√≠vel.
  const adContainer = document.getElementById('ad-container');
  if (adContainer) {
    adContainer.style.display = 'block';
    // Tenta carregar o an√∫ncio agora que o container est√° vis√≠vel.
    try {
      (adsbygoogle = window.adsbygoogle || []).push({});
    } catch (e) {
      console.error("Erro ao tentar carregar o an√∫ncio:", e);
    }
  }
}

 
  
      
      // ---------------- EVENTOS ----------------
if (button) {
  button.onclick = () => hasReading ? resetReading() : newReading();
}

document.addEventListener('click', (event) => {
  if (event.target && event.target.id === 'shareButton') {
    shareOnWhatsApp();
  }
});

window.addEventListener('load', () => {
  setTimeout(() => pageLoader?.classList.add('hidden'), 1500);
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js')
    .catch(err => console.warn('SW erro:', err));
}
});
      
   
</script>
</body>
</html>
